#!/bin/bash -eu

case "$1" in
  -v|--version)
    version="$2"
esac

shopt -s dotglob

VERSION_DIR=shared

export OPENSHIFT_HHVM_VERSION="$version"
source $OPENSHIFT_CARTRIDGE_SDK_BASH

echo "$version" > "$OPENSHIFT_HHVM_DIR/env/OPENSHIFT_HHVM_VERSION"

# build initial config
cp -Hr $OPENSHIFT_HHVM_DIR/versions/$VERSION_DIR/configuration/etc/* $OPENSHIFT_HHVM_DIR/configuration/etc/

# create symlinks for hhvm binaries
(cd "$OPENSHIFT_HHVM_DIR/versions/$VERSION_DIR/usr/bin" && ./symlinks.sh)